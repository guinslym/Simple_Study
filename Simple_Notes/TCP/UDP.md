用户数据报协议(UDP).md
##引言##
UDP位于应用层和IP层之间,它提供介于应用程序和网络功能之间的服务。
运输层协议通过具有几种责任,1种责任就是创建进程到进程的通信。UDP使用端口号来完成这种通信。另1种责任就是在运输层提供控制机制,UDP在1个非常低的水平上完成了这个功能。
UDP灭有流量控制机制,在收到分组时也没有确认。但是,UDP提供了某种程度的差错控制。如果UDP在收到的分组中检测出差错,它就悄悄地丢弃这个分组。
UDP是1种无连接、不可靠的运输协议(connectionless,unreliable transport protocol)。它除了在IP服务的基础上增加了进程到进程的通信,使之不再是主机到主机的通信之外,就再没什么了。
##用户数据报##
UDP分组叫做用户数据报(user datagrams),它有8个字节的固定首部。这些字段如下:

1. 源端口号,这是在源主机上运行的进程所使用的端口号。它有16位长,这就表示端口号可以从0~65535(当客户进程发送请求时),则在大多数情况下这个端口号是该进程请求的,并由运行在源主机上的UDP软件选择出来的1个临时端口号。如果源主机是服务器(当服务器进程发送响应时),则在大多数情况下这个端口号是1个熟知端口号。
2. 目的端口号,这是运行在目的主机上的进程所使用的端口号。它也是16位长,若目的主机是服务器(当客户进程发送请求时),则在大多数情况下这个端口号是熟知端口号。若目的主机是客户端(当服务器进程发送响应时),则大多数情况下这个端口号是1个临时端口号,此时服务器会把它接收到的请求分组中的临时端口号复制过来。
3. 总长度,这是1个16位的字段,它定义了用户数据报的总长度,首部加上数据。16位可定义的总长度是从0~65535字节。但是,实际的总长度必须比这个数值小,因为UDP用户数据报要放在总长度为65535字节的IP数据报之中。
4. 检验和，这个字段用来检测整个用户数据报(首部加上数据)出现的差错。

UDP长度=IP长度-IP首部长度
##UDP服务##
###进程到进程的通信###
UDP使用套接字(IP地址和端口号的组合)提供了进程到进程的通信。几个被UDP使用的端口号如下所示:

|端口号|协议|         说明                |
|------|-----|-----------------------------|
|7     |Echo |把收到的数据报回送到发送方|
|9     |Discard|丢弃收到的任何数据报      |
|53    |Domain|域名服务(DNS)               |
|111   |RPC   |远程过程调用               |
|161   |SNMP  |简单网络管理协议          |

###无连接服务###
UDP使用无连接服务,这就意味着由UDP发送的每1个用户数据报都是独立的数据报。不同的用户数据报之间没有任何关系，哪怕它们是来自相同的源进程并且去往相同的目的程序。此外,也没有像TCP那样的连接建立和连接终止过程，这就表示每1个用户数据报可以走不同的路径。
只有那些发送短报文的进程才应当使用UDP,也就是报文的长度要小于65507字节(65535减去8个字节的UDP首部,再减去20个字节的IP首部)。
###封装和解封###
要把报文从1个进程发送到另1个进程,UDP协议就要对报文进行封装和解封。
####封装####
当进程有报文要通过UDP发送时，它就把这个报文连同一对套接字以及数据的长度传递给UDP。
UDP收到数据后添加1个UDP首部,然后,UDP把这个用户数据报连同套接字地址一起传递给IP。
IP再加上自己的首部,在协议字段使用值17,指出该数据是从UDP协议来的,然后把这个IP数据报传递给数据链路层。
数据链路层收到IP数据报后,加上自己的首部(可能还有尾部),再传递给物理层。物理层把比特编码称电信号或光信号，并将其发送到远程的机器。
####解封####
当这个报文到达目的主机后,物理层首先将信号解码成比特,传递给数据链路层。
数据链路层利用首部(与尾部一起)检查数据。若无差错,就剥去首部和尾部,并把数据报传递给IP。
IP软件进行它自己的检查。若无差错,则剥去首部，把用户数据报连同发送方和接收方的IP地址一起传递给UDP。
UDP使用检验和对整个用户数据进行检查。若无差错,则剥去首部,把应用数据连同发送方的套接字地址一起传递给接收进程。之所以要把发送方的套接字地址也传递给进程是因为有可能需要对收到的报文进行响应。