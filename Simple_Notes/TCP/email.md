电子邮件.md
##报文传送代理:SMTP##
真正的邮件传送是通过报文传送代理(MTA)。要发送邮件,1个系统必须有客户MTA,而要接收邮件,1个系统就必须有MTA服务器。
定义互联网中的MTA客户和MTA服务器的正式协议称为简单邮件传送协议(SMTP)。
###命令和响应###
SMTP使用一些命令和响应在MTA客户和MTA服务器之间传送报文。每1个命令或响应都以二字符(回车或换行)的行结束标记终止。
命令是从客户端发送到服务器,命令的格式如下:`关键字:变量`。

|关键字|   变量    |
|------|------------|
|HELO  |发送方的主机名|
|MAIL FROM|发件人|
|RCPT TO|预期的收件人|
|DATA|邮件的主体|
|QUIT||
|RSET||
|VEFY|收件人名字|
|NOOP||
|TURN||
|EXPN|邮件发送清单|
|HELP|命令名|
|SEND FROM|预期的收件人|
|SMOL FROM|预期的收件人|
|SMAIL FROM|预期的收件人|

1. HELO,这个命令由客户用来标志自己而使用的。其变量是客户主机的域名。
2. MAIL FROM,这个命令由客户用来标记发件人,它的变量是发件人的电子邮箱地址(本地部分加上域名)。
3. RCPT TO,这个命令是客户用来标志预期的收件人,它的变量是收件人的电子邮箱地址。若有多个收件人,则命令要重复使用。
4. DATA,用于发送真正的报文。在DATA命令后面所有的行都被当做是邮件正文。报文的终止是只包含1个点的行。
5. QUIT,结束报文。
6. RSET,使当前的邮件事务异常终止。所存储的关于发件人和收件人的信息都被删除,连接将被复位。
7. VRFY,用于验证收件人的地址。它作为变量发送出去,发送方可以请接收方证实名字是否标志有效的收件人。
8. NOOP,由客户使用,用来检查收件人的状态。它需要收件人的回答。
9. TURN,让发件人和收件人交换位置,即发件人变成收件人。
1. EXPN,要求接收邮件的主机把作为变量的发送清单进行扩展,并返回组成清单的收件人的邮箱地址。
2. HELP,要求收件人发送作为变量的命令的有关信息。
3. SEND FROM,这个命令指明这个邮件是要交付到收件人的终端,而不是邮箱。若收件人没有登陆,邮件就被返回。变量就是发件人地址。
4. SMOL FROM,指明邮件是要交付到收件人的终端或邮箱。这就表示若收件人已登陆,邮件就只交付到终端。若收件人未登录,邮件就交付到邮箱。变量是发件人地址。
5. SMAL FROM,指明邮件是要交付到收件人的终端或邮箱。这就表示若收件人已登陆,邮件就只交付到终端和邮箱。若收件人未登录,邮件就交付到邮箱。变量是发件人地址。

响应是服务器发送到客户。响应是3位10进制数字,后面可以跟着附加的文本信息。类似于HTTP状态码。
###邮件传送阶段###
邮件报文的传送共有3个阶段:连接建立、报文传送和连接终止。
###连接建立###
当客户与熟知端口25建立TCP连接后,SMTP服务器就开始它的连接阶段。

1. 服务器发送代码220(服务就绪)高速客户它已准备接收邮件若服务器未就绪,它就发送代码421(服务不可用)。
2. 客户发送HELO报文,并使用它的域名地址标志自己。这个步骤是必要的,用来把客户的域名通知服务器。请记住,在TCP的连接建立阶段,发送方和接收方是通过它们的IP地址来知道对方的。
3. 服务器响应代码250(请求命令完成)或根据不同情况给出其他一些代码。

###报文传送###
在SMTP客户与服务器之间建立连接后,发件人就可以与1个或多个收件人交换单个的报文了。这个阶段包括8个步骤,若收件人超过1个,则步骤3和4将重复进行。

1. 客户发送MAIL FROM报文介绍报文的发送者。它包括发件人的邮件地址(邮箱和域名)。这个步骤是必要的,它可以把返回邮件地址交给服务器,以便返回差错或报告报文时使用。
2. 服务器响应代码250或其他适当的代码。
3. 客户发送RCPT TO(收件人)报文,包括收件人的邮件地址。
4. 服务器响应代码250或其他适当的代码。
5. 客户发送DATA报文对报文的传送进行初始化。
6. 服务器响应代码354(开始邮件输入)或其他适当的报文。
7. 客户用连续的行发送报文的内容。每1行以二字符的行结束标记(回车或换行)终止。这个报文以仅有1个点的行结束。
8. 服务器响应代码250(OK)或其他适当的代码。

###连接终止###
在报文传送成功后,客户就终止连接。这个阶段包括2个步骤:

1. 客户发送QUIT命令。
2. 服务器响应代码221或其他适当的代码。

在连接终止阶段后,TCP连接必须关闭。
##报文读取代理:POP和IMAP##
目前,共有2种报文读取协议可以使用:邮局协议版本3(POP3)和互联网邮件读取协议版本4(IMAP4).
###POP3###
当用户需要从邮件服务器的邮箱中下载电子邮件时,可以就开始读取邮件。客户(用户代理)在TCP端口110打开到服务器的连接,然后它发送用户名和口令,访问邮箱。用户可以列出清单,并逐个读取邮件报文.
POP3有2种方式,删除方式和保存方式。删除方式就在每1次读取邮件后就把邮箱中这个邮件删除。保存方式就是在读取邮件后仍然在邮箱中保存这个邮件。
###IMAP4###
IMAP4与POP3类似,但是提供了以下一些更多的功能:

1. 用户在下载邮件之前可以检查邮件的首部。
2. 用户在下载邮件之前可以用特定的字符串搜索电子邮件的内容。
3. 用户可以部分地下载电子邮件。如果在电子邮箱中包含了高带宽需求的多媒体信息而带宽又受到限制时特别有用。
4. 用户可以在邮件服务器上创建、删除邮箱或对邮箱更新。
5. 为了存放电子邮件,用户可以在文件夹中创建分层次的邮箱。

